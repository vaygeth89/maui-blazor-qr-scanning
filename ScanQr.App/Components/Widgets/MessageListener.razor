@using Microsoft.AspNetCore.SignalR.Client
@using Refit
@using ScanQrShared
@using System.Diagnostics
@inject HttpClient HttpClient

<div>
    @ChildContent
</div>

@code{
    [Parameter] public RenderFragment ChildContent { get; set; }

    private HubConnection hubConnection { get; set; }
    
    protected override async Task OnInitializedAsync()
    {
        try
        {
            hubConnection = new HubConnectionBuilder()
                .WithUrl("http://172.16.1.150:5026/Chat")
                .Build();

            hubConnection.On<Person>("ReceiveMessage", ListenToMessages);

            await hubConnection.StartAsync();
            // You can send a message like this
            // await hubConnection.SendAsync("ReceiveMessage", "Hello from the client");
            HttpClient.BaseAddress = new Uri("http://172.16.1.150:5026/persons");
            var qrCodeVerificationService = RestService.For<IQrCodeVerificationClient>(HttpClient);

            qrCodeVerificationService.SendPersonInformationMessage();
        }
        catch (Exception ex)
        {
            // Log or display the error message
            Console.WriteLine(ex.Message);
        }

    }
    
    private void ListenToMessages(Person person)
    {
        Trace.WriteLine(person.FirstName);
        Console.WriteLine(person.LastName);
    }

}